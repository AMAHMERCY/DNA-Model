{% load static %}

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Register | DNA Healthcare</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        body { background: #f5f7fa; height: 100vh; margin: 0; }
        .split-container { display: flex; height: 100vh; overflow: hidden; }
        .left-panel { flex: 1; padding: 60px 70px; overflow-y: auto; background: white; }
        .right-panel { flex: 1; background-size: cover; background-position: center; background-repeat: no-repeat; }
        .form-section { display: none; }
        .form-section.active { display: block; }
        .title { font-weight: 700; color: #0d6efd; margin-bottom: 20px; }
    </style>
</head>

<body>

<div class="split-container">

    <!-- LEFT PANEL -->
    <div class="left-panel">
        <h2 class="title">Create Your Account</h2>

        <form id="registerForm">

            <div id="message" class="text-danger mb-3"></div>

            <!-- STEP 1 -->
            <div id="step1" class="form-section active">

                <div class="mb-3">
                    <label class="form-label">Full Name</label>
                    <input type="text" class="form-control" name="name" required>
                </div>

                <div class="mb-3">
                    <label class="form-label">Email Address</label>
                    <input type="email" class="form-control" name="email" required>
                </div>

                <div class="mb-3">
                    <label class="form-label">Password</label>
                    <input type="password" class="form-control" name="password" required>
                </div>

                <div class="mb-3">
                    <label class="form-label">Date of Birth</label>
                    <input type="date" class="form-control" name="date_of_birth" required>
                </div>

                <div class="mb-3">
                    <label class="form-label">Phone Number</label>
                    <input type="text" class="form-control" name="phone" required>
                </div>

                <button type="button" class="btn btn-primary w-100 mt-3" onclick="goToStep2()">Next</button>
            </div>

            <!-- STEP 2 -->
            <div id="step2" class="form-section">

                 <div class="mb-3">
                    <label class="form-label">Post Code</label>
                    <input type="text" class="form-control" name="post_code" required>
                </div>

                <div class="mb-3">
                    <label class="form-label">Sex</label>
                    <select class="form-select" name="sex" required>
                        <option value="male">Male</option>
                        <option value="female">Female</option>
                        <option value="other">Other</option>
                    </select>
                </div>

                <div class="mb-3">
                    <label class="form-label">Chronic Health Condition</label>
                    <select class="form-select" name="chronic_condition" id="chronicDropdown" required>
                        <option value="">Select condition</option>
                        <option value="diabetes">Diabetes</option>
                        <option value="hypertension">Hypertension</option>
                        <option value="asthma">Asthma</option>
                        <option value="heart disease">Heart Disease</option>
                        <option value="none">None</option>
                        <option value="other">Other (please specify)</option>
                    </select>
                </div>

                <div class="mb-3" id="chronicOtherBox" style="display:none;">
                    <label class="form-label">Specify Other Condition</label>
                    <input type="text" class="form-control" name="chronic_other">
                </div>

                <button type="button" class="btn btn-outline-secondary w-100 mt-3" onclick="goToStep1()">Back</button>

                <button type="submit" class="btn btn-primary w-100 mt-3">Register</button>

            </div>

        </form>
    </div>

    <!-- RIGHT PANEL -->
    <div class="right-panel"
         style="background-image: url('{% static "DNA_website/Image/register_image.jpg" %}');">
    </div>

</div>

<!-- JS -->
<script>
function goToStep2() {
    document.getElementById("step1").classList.remove("active");
    document.getElementById("step2").classList.add("active");
}

function goToStep1() {
    document.getElementById("step2").classList.remove("active");
    document.getElementById("step1").classList.add("active");
}

document.getElementById("chronicDropdown").addEventListener("change", function () {
    document.getElementById("chronicOtherBox").style.display =
        this.value === "other" ? "block" : "none";
});

// JAVASCRIPT FETCH SUBMISSION (DRF STYLE)
document.getElementById("registerForm").addEventListener("submit", async function (e) {
    e.preventDefault();

    const payload = {
        name: document.querySelector("input[name='name']").value,
        email: document.querySelector("input[name='email']").value,
        password: document.querySelector("input[name='password']").value,
        date_of_birth: document.querySelector("input[name='date_of_birth']").value,
        phone: document.querySelector("input[name='phone']").value,
        post_code: document.querySelector("input[name='post_code']").value,
        sex: document.querySelector("select[name='sex']").value,
        chronic_condition: document.querySelector("select[name='chronic_condition']").value,
        chronic_other: document.querySelector("input[name='chronic_other']").value,
    };

    try {
        const response = await fetch("/api/accounts/register/", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload)
        });

        const data = await response.json();
console.log(data)
        if (response.ok) {
            document.getElementById("message").classList.remove("text-danger");
            document.getElementById("message").classList.add("text-success");
            document.getElementById("message").innerText = "Registration successful!";
            window.location.href = "/login/";
        } else {
            document.getElementById("message").innerText = JSON.stringify(data);
        }

    } catch (error) {
        document.getElementById("message").innerText = "Something went wrong.";
    }
});
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>
